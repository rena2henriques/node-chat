if (self.CavalryLogger) { CavalryLogger.start_js(["jJ8cR"]); }

__d('MercurySharePreview.react',['cx','invariant','AsyncRequest','LeftRight.react','MercuryFallbackShareAttachment.react','MercuryShareAttachmentRenderLocations','React','XUICloseButton.react','XUISpinner.react','setImmediate'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.$MercurySharePreview1=1337,this.$MercurySharePreview2=null,this.state={attachmentData:null,loading:false},this.$MercurySharePreview11=function(){this.$MercurySharePreview5();this.props.onClose&&this.props.onClose(this.props.threadID);}.bind(this),o;}m.prototype.componentWillMount=function(){this.$MercurySharePreview3(this.props.share);this.$MercurySharePreview4(this.props.uri);};m.prototype.componentWillUnmount=function(){this.$MercurySharePreview5();};m.prototype.componentWillReceiveProps=function(n){!(n.share&&n.uri)||i(0);if(!n.share&&!n.uri)this.$MercurySharePreview5();this.$MercurySharePreview3(n.share);this.$MercurySharePreview4(n.uri);};m.prototype.$MercurySharePreview3=function(n){var o=this.state.attachmentData||this.state.loading;if(n&&!o)this.$MercurySharePreview6(n);};m.prototype.$MercurySharePreview4=function(n){var o=this.state.attachmentData||this.state.loading;if(n&&!(o&&this.props.uri===n))this.$MercurySharePreview7(n);};m.prototype.componentDidUpdate=function(n,o){this.props.onUpdate&&this.props.onUpdate(this);};m.prototype.getShareData=function(){return this.state.attachmentData&&this.state.attachmentData.share_data;};m.prototype.isLoading=function(){return this.state.loading;};m.prototype.$MercurySharePreview6=function(n){this.$MercurySharePreview2=new (c('AsyncRequest'))().setURI('/message_share_attachment/fromParams/').setData({image_height:this.props.imageSize.height,image_width:this.props.imageSize.width,share_params:n.params,share_type:n.type}).setHandler(this.$MercurySharePreview8.bind(this,this.$MercurySharePreview9()));c('setImmediate')(function(){this.props.onLoading&&this.props.onLoading(this.props.threadID);}.bind(this));this.$MercurySharePreview2&&this.$MercurySharePreview2.send();this.setState({loading:true,attachmentData:null});};m.prototype.$MercurySharePreview7=function(n){this.$MercurySharePreview2=new (c('AsyncRequest'))().setURI('/message_share_attachment/fromURI/').setData({image_height:this.props.imageSize.height,image_width:this.props.imageSize.width,uri:n}).setHandler(this.$MercurySharePreview8.bind(this,this.$MercurySharePreview9()));c('setImmediate')(function(){this.props.onLoading&&this.props.onLoading(this.props.threadID);}.bind(this));this.$MercurySharePreview2&&this.$MercurySharePreview2.send();this.setState({loading:true,attachmentData:null});};m.prototype.$MercurySharePreview9=function(){return ++this.$MercurySharePreview1;};m.prototype.$MercurySharePreview10=function(){return this.$MercurySharePreview1;};m.prototype.$MercurySharePreview8=function(n,o){if(this.$MercurySharePreview10()!==n)return;var p=o.payload;if(p){this.props.onLoaded&&this.props.onLoaded(this.props.threadID,p);this.setState({loading:false,attachmentData:p});}else this.props.onClose&&this.props.onClose(this.props.threadID);};m.prototype.$MercurySharePreview5=function(){this.$MercurySharePreview9();this.$MercurySharePreview2&&this.$MercurySharePreview2.abort();this.$MercurySharePreview2=null;this.setState({loading:false,attachmentData:null});};m.prototype.render=function(){var n="_tig"+(' '+"_tih");if(this.state.loading)return c('React').createElement(c('LeftRight.react'),{direction:c('LeftRight.react').DIRECTION.right,className:n},c('React').createElement(c('XUISpinner.react'),{className:"_tii",size:'large',background:'light'}),c('React').createElement(c('XUICloseButton.react'),{className:"_tij",shade:'dark',size:'small',onClick:this.$MercurySharePreview11}));var o=this.state.attachmentData;if(!o)return c('React').createElement('div',null);return c('React').createElement('div',null,c('React').createElement(c('MercuryFallbackShareAttachment.react'),{attachment:o,location:c('MercuryShareAttachmentRenderLocations').CHAT_PREVIEW}),c('React').createElement(c('XUICloseButton.react'),{className:"_tij",shade:'dark',size:'small',onClick:this.$MercurySharePreview11}));};m.propTypes={threadID:l.string,imageSize:l.shape({width:l.number.isRequired,height:l.number.isRequired}).isRequired,location:l.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()).isRequired,share:l.shape({params:l.array,type:l.number}),uri:l.string,onClose:l.func,onLoaded:l.func,onLoading:l.func,onUpdate:l.func};f.exports=m;}),null);