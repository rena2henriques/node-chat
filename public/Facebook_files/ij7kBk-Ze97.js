if (self.CavalryLogger) { CavalryLogger.start_js(["jh5Eg"]); }

__d('SpatialReactionConsumptionTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:SpatialReactionConsumptionLoggerConfig',this.$SpatialReactionConsumptionTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:SpatialReactionConsumptionLoggerConfig',this.$SpatialReactionConsumptionTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$SpatialReactionConsumptionTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$SpatialReactionConsumptionTypedLogger1=babelHelpers['extends']({},this.$SpatialReactionConsumptionTypedLogger1,j);return this;};h.prototype.setCenterPitch=function(j){this.$SpatialReactionConsumptionTypedLogger1.center_pitch=j;return this;};h.prototype.setCenterYaw=function(j){this.$SpatialReactionConsumptionTypedLogger1.center_yaw=j;return this;};h.prototype.setDisplayState=function(j){this.$SpatialReactionConsumptionTypedLogger1.display_state=j;return this;};h.prototype.setEvent=function(j){this.$SpatialReactionConsumptionTypedLogger1.event=j;return this;};h.prototype.setFriendCount=function(j){this.$SpatialReactionConsumptionTypedLogger1.friend_count=j;return this;};h.prototype.setHasNonFriend=function(j){this.$SpatialReactionConsumptionTypedLogger1.has_non_friend=j;return this;};h.prototype.setMoveTowardsHint=function(j){this.$SpatialReactionConsumptionTypedLogger1.move_towards_hint=j;return this;};h.prototype.setPitch=function(j){this.$SpatialReactionConsumptionTypedLogger1.pitch=j;return this;};h.prototype.setReactionKey=function(j){this.$SpatialReactionConsumptionTypedLogger1.reaction_key=j;return this;};h.prototype.setVideoTimestamp=function(j){this.$SpatialReactionConsumptionTypedLogger1.video_timestamp=j;return this;};h.prototype.setYaw=function(j){this.$SpatialReactionConsumptionTypedLogger1.yaw=j;return this;};var i={center_pitch:true,center_yaw:true,display_state:true,event:true,friend_count:true,has_non_friend:true,move_towards_hint:true,pitch:true,reaction_key:true,video_timestamp:true,yaw:true};f.exports=h;}),null);
__d('SpatialReactionExperimentsStore',['SphericalVideoComponentConstants','SphericalVideoComponentDispatcher','FluxMapStore','immutable','idx'],(function a(b,c,d,e,f,g){'use strict';var h,i,j,k;h=babelHelpers.inherits(l,c('immutable').Record({viewportLimiting:''}));i=h&&h.prototype;function l(){h.apply(this,arguments);}j=babelHelpers.inherits(m,c('FluxMapStore'));k=j&&j.prototype;m.prototype.getInitialState=function(){return c('immutable').Map({});};m.prototype.reduce=function(n,o){var p=o.id;switch(o.type){case c('SphericalVideoComponentConstants').ACTIONS.REGISTER_EXPERIMENT_CONFIG:var q=o.config;n=n.set(p,new l(babelHelpers['extends']({},q)));break;default:break;}return n;};m.prototype.shouldDisableReactions=function(n){var o,p=this.getState().get(n);return ((o=p)!=null?o.viewportLimiting:o)==='none';};m.prototype.shouldDisableInitialViewportReactions=function(n){var o,p=this.getState().get(n);return ((o=p)!=null?o.viewportLimiting:o)==='no_initial_viewport';};m.prototype.shouldOnlyShowHints=function(n){var o,p=this.getState().get(n);return ((o=p)!=null?o.viewportLimiting:o)==='hint_only';};function m(){j.apply(this,arguments);}f.exports=new m(c('SphericalVideoComponentDispatcher'));}),null);
__d('SpatialReactionLoggingConstants',[],(function a(b,c,d,e,f,g){'use strict';var h={FUNNEL_ACTIONS:{CLICK_LIKE:'click_like',OPEN_REACTION_MENU:'open_reaction_menu',CLICK_REACTION:'click_reaction',CLOSE_REACTION_MENU:'close_reaction_menu',PICK_UP_REACTION:'pick_up_reaction',RELEASE_REACTION_ON_VIDEO:'relase_reactions_on_video',RELEASE_REACTION_SOMEWHERE_ELSE:'release_reaction_somewhere_else'},FUNNEL_NAME:'WWW_SPATIAL_REACTION_PRODUCTION_FUNNEL',PLAY_TAG:'video_is_playing',PAUSE_TAG:'video_is_paused',CONSUMPTION_DISPLAY_STATES:{DISPLAY:0,HINT:1,OUT_OF_VIEWPORT:2,DISABLED:3}};f.exports=h;}),null);
__d('SpatialReaction',['FeedbackReactionType','immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('immutable').Record({animationRandomSeed:0,isFriend:false,profilePictureURI:null,reactionType:c('FeedbackReactionType').LIKE,positionIndex:-1});h=babelHelpers.inherits(k,j);i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('SpatialReactionAnimationConfig',['CubicBezier'],(function a(b,c,d,e,f,g){'use strict';var h=60,i=function o(p,q,r,s){return {solve:function t(u,v,w,x){var y=new (c('CubicBezier'))([p,q],[r,s]);return w*y.solve(u/x)+v;}};},j={solve:function o(p,q,r,s){return p/s*r+q;}},k=function o(p){return {solve:function q(r,s,t,u,v){if(r<v){return s;}else return p.solve(r-v,s,t,u-v);}};},l=function o(p){return {solve:function q(r,s,t,u,v){if(r<u-v){return p.solve(r,s,t,u-v);}else return s+t;}};},m=function o(p){return {solve:function q(r,s,t,u,v,w){if(v+w>u)throw new Error('Delay exceeds total steps');if(r<v){return s;}else if(r>=u-w){return s+t;}else return p.solve(r-v,s,t,u-v-w);}};},n={CLICK:{NUM_POSITIONS:2,LEFT_RIGHT_MARGIN:{PERCENT:.1}},CURVES:{MOVE_TO_CENTER_SCALE:i(.25,0,.58,1.02),MOVE_TO_CENTER_PATH_X:i(.3,.3,.5,1),MOVE_TO_CENTER_PATH_Y:i(0,.75,.9,.8),LOOK_AT_CENTER_PATH_X:l(i(.2,.2,.3,1)),LOOK_AT_CENTER_PATH_Y:l(i(.2,.2,.6,1)),LOOK_AT_CENTER_SCALE_SELF:m(i(0,.7,.6,1)),LOOK_AT_CENTER_SCALE_NON_SELF:m(i(.9,0,.25,1)),LOOK_AT_CENTER_FACE_POSITION:j,LOOK_AT_CENTER_FACE_SCALE_X:j,FACE_FLIP:m(j),MOVE_BACK_TOWARD_CENTER_PATH_X:i(.4,0,0,.8),MOVE_BACK_TOWARD_CENTER_PATH_Y:i(.4,.6,0,1),MOVE_BACK_TOWARD_CENTER_SCALE:m(i(.9,0,.25,1)),MOVE_BACK_TOWARD_CENTER_FACE_SCALE_X:m(j)},DRAG:{THROTTLE_INTERVAL:{MS:200},THRESHOLD:{MS:200},FRICTION_COEFFICIENT:.15,ORIGINAL_SCALE_VALUE:'scale(0.8)',VELOCITY:{MAX:600},FACE:{OFFSET:{LOVE:{PX:15}},SCALE:{MIN:.85}}},DURATIONS:{SELF:{TOTAL:{SECONDS:2.15,FRAMES:2.15*h},MOVE_TO_CENTER:{SECONDS:.35,FRAMES:.35*h},LOOK_AT_CENTER:{SECONDS:.7,FRAMES:.7*h,MAX_RANDOM_DELAY_FRAMES:0*h,MIN_RANDOM_SCALE_DELAY_FRAMES:0*h,MAX_RANDOM_SCALE_DELAY_FRAMES:0*h},MOVE_BACK_TOWARD_CENTER:{SECONDS:1.1,FRAMES:1.1*h,MAX_RANDOM_SCALE_DELAY_FRAMES:.95*h},SCALE_DOWN:{SECONDS:.15,FRAMES:.15*h},SCALE_UP:{SECONDS:.15,FRAMES:.15*h},FACE_FLIP:{SECONDS:.15,FRAMES:.15*h},FACE_HANG:{SECONDS:.2,FRAMES:.2*h}},NON_SELF:{TOTAL:{SECONDS:2,FRAMES:2*h},MOVE_TO_CENTER:{SECONDS:0,FRAMES:0*h},LOOK_AT_CENTER:{SECONDS:1.5,FRAMES:1.5*h,MAX_RANDOM_DELAY_FRAMES:.8*h,MIN_RANDOM_SCALE_DELAY_FRAMES:.3*h,MAX_RANDOM_SCALE_DELAY_FRAMES:1.35*h},MOVE_BACK_TOWARD_CENTER:{SECONDS:.5,FRAMES:.5*h,MAX_RANDOM_SCALE_DELAY_FRAMES:.35*h},SCALE_DOWN:{SECONDS:.15,FRAMES:.15*h},SCALE_UP:{SECONDS:.15,FRAMES:.15*h},FACE_FLIP:{SECONDS:.15,FRAMES:.15*h},FACE_HANG:{SECONDS:.2,FRAMES:.2*h}}},SHADOW:{COLOR:'rgba(0, 0, 0, 0.4)',BLUR:70,OFFSET_X:6,OFFSET_Y:6},SIZES:{BASE:{PX:38},PROFILE:{PX:34},FACE:{PX:38}},OPACITY:{MAX:1,MIN:0},SCALES:{COIN_FLIP_MORPH_START:.7,MOVE_TO_CENTER:{MIN:.6,MAX:1},LOOK_AT_CENTER:{MIN:.6,MID:.8,MAX:1,SELF_MIN:0},LOOK_AT_CENTER_FACE_X:{MAX:1,MIN:.8},MOVE_BACK_TOWARD_CENTER:{MAX:1,MIN:0}},DISTANCES:{LOOK_AT_CENTER:{SELF:{X:{PX:125},Y:{PX:100}},NON_SELF:{X:{PX:185},Y:{PX:100}},RANDOM_OFFSET_X:{MIN:{PX:-10},MAX:{PX:40}}},MOVE_BACK_TOWARD_CENTER:{X:{PX:40},Y:{PX:30}},MAX_FACE_OFFSET:{PX:6},FACE_FLIP_OUT_OFFSET:{PX:30},MAX_PROFILE_PICTURE_OFFSET:{PX:38}}};f.exports=n;}),null);
__d('SpatialReactionClusterBase',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('immutable').Record({animationDurationFrames:-1,animationPitch:null,animationProgressFrames:-1,animationYaw:null,anonymousReactions:c('immutable').Set(),friendReactions:c('immutable').Set(),isHint:false,isSelfReaction:false,originalPitch:0,originalYaw:0,timestamp:-1});h=babelHelpers.inherits(k,j);i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('SpatialReactionCluster',['SpatialReactionClusterBase'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('SpatialReactionClusterBase'));i=h&&h.prototype;j.prototype.hasStartedAnimating=function(){return this.animationProgressFrames>=0;};j.prototype.startAnimation=function(k,l){var m=arguments.length<=2||arguments[2]===undefined?false:arguments[2];return this.set('animationProgressFrames',0).set('isHint',m).set('animationYaw',k).set('animationPitch',l);};j.prototype.stopAnimation=function(){return this.set('animationProgressFrames',-1).set('isHint',false);};j.prototype.tickAnimation=function(){var k=this.animationProgressFrames;return this.set('animationProgressFrames',k+1);};j.prototype.isAnimationFinished=function(){return this.animationProgressFrames>=this.animationDurationFrames;};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d("denormalizeYaw",[],(function a(b,c,d,e,f,g){function h(i){var j=arguments.length<=1||arguments[1]===undefined?false:arguments[1],k=j?Math.PI:180,l=k*2;return i<=0?i+l:i;}f.exports=h;}),null);
__d('SpatialReactionsUtils',['csx','Alea','SpatialReactionAnimationConfig','DOM','DOMClone','DOMQuery','immutable','Rect','SpatialReaction','Scroll','Style','Vector','SpatialReactionCluster','VideoChannel','denormalizeYaw','getElementPosition'],(function a(b,c,d,e,f,g,h){'use strict';var i={processServerReactionsPayloads:function j(k){var l=c('immutable').Set();for(var m=k,n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var p;if(n){if(o>=m.length)break;p=m[o++];}else{o=m.next();if(o.done)break;p=o.value;}var q=p;l=l.add(i.createSpatialReactionClusterFromData(q));}return l;},createSpatialReactionClusterFromData:function j(k){var l=k.yaw,m=k.pitch,n=k.timestamp;l=c('denormalizeYaw')(l);var o=0,p=c('SpatialReactionAnimationConfig').DURATIONS.NON_SELF.TOTAL.FRAMES,q=new (c('Alea'))(l+m+n+''),r=k.friend_reactions.reduce(function(t,u){return t.add(new (c('SpatialReaction'))({animationRandomSeed:q(),reactionType:u.reaction_type,profilePictureURI:u.profile_picture_uri,isFriend:true,positionIndex:o++}));},c('immutable').Set()),s=k.popular_reactions.reduce(function(t,u){return t.add(new (c('SpatialReaction'))({animationRandomSeed:q(),reactionType:u.reaction_type,positionIndex:o++}));},c('immutable').Set());return new (c('SpatialReactionCluster'))({animationDurationFrames:p,anonymousReactions:s,friendReactions:r,originalPitch:m,originalYaw:l,timestamp:n});},getChannelViewViewportRect:function j(){if(c('VideoChannel').get()){return new (c('Rect'))(c('DOMQuery').find(c('VideoChannel').get().getDialogContent(),"._1kfk"));}else throw new Error('Not currently in channel view');},isVectorWithinViewport:function j(k,l,m){return !(k.x>l||k.x<0||k.y>m||k.y<0);},getRootElement:function j(){return c('DOM').find(document.body,"._li");},getReactionCenterVector:function j(k){var l=c('SpatialReactionAnimationConfig').SIZES.BASE.PX/2,m=c('getElementPosition')(k);return new (c('Vector'))(m.x+l+c('Scroll').getLeft(document.body),m.y+l+c('Scroll').getTop(document.body),'document');},insertOnTop:function j(k,l){var m=arguments.length<=2||arguments[2]===undefined?0:arguments[2],n=i.getRootElement(),o=k.getBoundingClientRect(),p=c('Scroll').getTop(document.body),q=o.top-o.width+p,r=o.left;c('DOM').insertAfter(n,l);c('Style').set(l,'position','absolute');c('Style').set(l,'left',r+'px');c('Style').set(l,'top',q-m+'px');c('Style').set(l,'z-index','1000');},cloneNode:function j(k){return c('DOMClone').deepClone(k);},hashId:function j(k){var l=0;if(k.length===0)return l;for(var m=0;m<k.length;m++){var n=k.charCodeAt(m);l=(l<<5)-l+n;l&=l;}return l;}};f.exports=i;}),null);
__d('SpatialReactionFunnelLoggingStore',['SphericalVideoComponentConstants','SpatialReactionLoggingConstants','SphericalVideoComponentDispatcher','FluxReduceStore','FunnelLogger','VideoPlayerControllerStore','curry','SpatialReactionsUtils'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('SphericalVideoComponentConstants').ACTIONS,k=c('SpatialReactionsUtils').hashId;h=babelHelpers.inherits(l,c('FluxReduceStore'));i=h&&h.prototype;l.prototype.getInitialState=function(){return {};};l.prototype.reduce=function(m,n){var o=n.id,p=c('curry')(this.$SpatialReactionFunnelLoggingStore1,o);switch(n.type){case j.CLICK_LIKE_BUTTON:this.$SpatialReactionFunnelLoggingStore2(o);p(c('SpatialReactionLoggingConstants').FUNNEL_ACTIONS.CLICK_LIKE);this.$SpatialReactionFunnelLoggingStore3(o);break;case j.OPEN_REACTION_MENU:this.$SpatialReactionFunnelLoggingStore2(o);p(c('SpatialReactionLoggingConstants').FUNNEL_ACTIONS.OPEN_REACTION_MENU);break;case j.CLOSE_REACTION_MENU:p(c('SpatialReactionLoggingConstants').FUNNEL_ACTIONS.CLOSE_REACTION_MENU);this.$SpatialReactionFunnelLoggingStore3(o);break;case j.CLICK_REACTION:p(c('SpatialReactionLoggingConstants').FUNNEL_ACTIONS.CLICK_REACTION);this.$SpatialReactionFunnelLoggingStore3(o);break;case j.SET_MOUSE_DOWN:p(c('SpatialReactionLoggingConstants').FUNNEL_ACTIONS.PICK_UP_REACTION);break;case j.DROP_REACTION:if(n.recordMouseLocation){p(n.reactionOutsideViewport?c('SpatialReactionLoggingConstants').FUNNEL_ACTIONS.RELEASE_REACTION_SOMEWHERE_ELSE:c('SpatialReactionLoggingConstants').FUNNEL_ACTIONS.RELEASE_REACTION_ON_VIDEO);this.$SpatialReactionFunnelLoggingStore3(o);}break;default:break;}return m;};l.prototype.$SpatialReactionFunnelLoggingStore2=function(m){var n=k(m),o=c('VideoPlayerControllerStore').getIsPlaying(m),p=o?c('SpatialReactionLoggingConstants').PLAY_TAG:c('SpatialReactionLoggingConstants').PAUSE_TAG;c('FunnelLogger').startFunnel(c('SpatialReactionLoggingConstants').FUNNEL_NAME,n);c('FunnelLogger').addFunnelTag(c('SpatialReactionLoggingConstants').FUNNEL_NAME,n,p);};l.prototype.$SpatialReactionFunnelLoggingStore3=function(m){var n=k(m);c('FunnelLogger').endFunnel(c('SpatialReactionLoggingConstants').FUNNEL_NAME,n);};l.prototype.$SpatialReactionFunnelLoggingStore1=function(m,n){var o=k(m);c('FunnelLogger').appendAction(c('SpatialReactionLoggingConstants').FUNNEL_NAME,o,n);};function l(){h.apply(this,arguments);}f.exports=new l(c('SphericalVideoComponentDispatcher'));}),null);
__d("SpatialReactionConsumptionLoggingEvents",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({SPATIAL_REACTION_DISPLAY:"spatial_reaction_display"});}),null);
__d("SpatialReactionDisplayStates",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({DISPLAY:0,HINT:1,OUT_OF_VIEWPORT:2,DISABLED:3});}),null);
__d('SpatialReactionAnimationUtils',['Promise','SpatialReactionAnimationConfig','CSS','Style','Vector','FeedbackReactionType','SphericalProjectionUtils','SpatialReactionsUtils','getVendorPrefixedEventName','setInterval'],(function a(b,c,d,e,f,g){'use strict';var h=c('SpatialReactionAnimationConfig').CURVES,i=h.LOOK_AT_CENTER_FACE_POSITION,j=h.LOOK_AT_CENTER_FACE_SCALE_X,k=h.FACE_FLIP,l=h.MOVE_BACK_TOWARD_CENTER_FACE_SCALE_X,m=c('getVendorPrefixedEventName')('animationend'),n=c('getVendorPrefixedEventName')('transitionend'),o=10,p={canStartClusterAnimation:function q(r,s,t){var u=s.friendReactions.union(s.anonymousReactions),v=function x(y,z){var aa=z.profilePictureURI,ba=z.reactionType;if(aa){var ca=t.hasFriendImage(aa);y=y&&ca;}var da=t.hasReactionBaseImage(ba)&&t.hasReactionFaceImage(ba);y=y&&da;return y;},w=u.reduce(v,true);return p.clusterIsWithinOneSecond(r,s.timestamp)&&!s.hasStartedAnimating()&&w;},resetClusterAnimationIfNeeded:function q(r){return r.isAnimationFinished()?p.resetClusterAnimation(r):r;},resetClusterAnimation:function q(r){var s=p.convertToNonSelfAnimation;return s(r.stopAnimation());},convertToNonSelfAnimation:function q(r){if(r.isSelfReaction){var s=c('SpatialReactionAnimationConfig').DURATIONS.NON_SELF.TOTAL.FRAMES;r=r.set('isSelfReaction',false);r=r.set('animationDurationFrames',s);}return r;},getReactionBaseSize:function q(r){return Math.floor(c('SpatialReactionAnimationConfig').SIZES.BASE.PX*r);},getReactionRadius:function q(r){return Math.floor(c('SpatialReactionAnimationConfig').SIZES.BASE.PX/2*r);},getProfilePictureRadius:function q(r){return Math.floor(c('SpatialReactionAnimationConfig').SIZES.PROFILE.PX/2*r);},getReactionIndexOnLeft:function q(r){return r.positionIndex%2===0;},getReactionFaceDimensions:function q(r,s,t){var u=p.getDurationsForClusterType,v=p.getClusterIsLookingAtCenter,w=p.getLookAtCenterProgressFrames,x=p.getClusterIsMovingBackTowardCenter,y=p.getMoveBackTowardCenterProgressFrames,z=1,aa=1,ba=c('SpatialReactionAnimationConfig').SIZES.FACE.PX,ca=c('SpatialReactionAnimationConfig').SCALES.LOOK_AT_CENTER_FACE_X.MIN,da=c('SpatialReactionAnimationConfig').SCALES.LOOK_AT_CENTER_FACE_X.MAX,ea=u(r,c('SpatialReactionAnimationConfig')),fa=ea.LOOK_AT_CENTER.FRAMES;if(v(r)){var ga=w(r);z=j.solve(ga,da,-(da-ca),fa);}else if(x(r)){var ha=ea.MOVE_BACK_TOWARD_CENTER.FRAMES,ia=ea.SCALE_DOWN.FRAMES,ja=y(r),ka=c('SpatialReactionAnimationConfig').SCALES.MOVE_BACK_TOWARD_CENTER.MIN,la=c('SpatialReactionAnimationConfig').SCALES.LOOK_AT_CENTER_FACE_X.MAX,ma=ea.MOVE_BACK_TOWARD_CENTER.MAX_RANDOM_SCALE_DELAY_FRAMES,na=Math.floor(s.animationRandomSeed*ma),oa=ha-na-ia;z=l.solve(ja,la,-(la-ka),ha,na,oa);}return new (c('Vector'))(Math.floor(ba*t*z),Math.floor(ba*t*aa));},clusterIsWithinOneSecond:function q(r,s){var t=s-.5,u=s+.5;return r>t&&r<u;},getPercentageWithOffset:function q(r,s,t){return (s-r)/(t-r);},getPercentageWithMax:function q(r,s){return Math.min(r,s)/s;},getDurationsForClusterType:function q(r,s){return r.isSelfReaction?s.DURATIONS.SELF:s.DURATIONS.NON_SELF;},getMoveToCenterProgressFrames:function q(r){if(!r.isSelfReaction){throw new Error('Non self clusters do not move to center');}else{var s=c('SpatialReactionAnimationConfig').DURATIONS,t=s.SELF.MOVE_TO_CENTER.FRAMES,u=r.animationProgressFrames;if(u<0||u>=t)throw new Error('Animation progress value not in move to center range: '+u);return u;}},getLookAtCenterProgressFrames:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c('SpatialReactionAnimationConfig')),u=t.LOOK_AT_CENTER.FRAMES,v=t.MOVE_TO_CENTER.FRAMES,w=s-v;if(w<0||w>=u)throw new Error('Animation progress value not in look at center range: '+w);return w;},getMoveBackTowardCenterProgressFrames:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c('SpatialReactionAnimationConfig')),u=t.MOVE_BACK_TOWARD_CENTER.FRAMES,v=t.MOVE_TO_CENTER.FRAMES+t.LOOK_AT_CENTER.FRAMES,w=s-v;if(w<0||w>=u)throw new Error('Animation progress value not in face flip range: '+w);return w;},getClusterIsMovingToCenter:function q(r){var s=p.getDurationsForClusterType(r,c('SpatialReactionAnimationConfig')),t=s.MOVE_TO_CENTER.FRAMES;return r.isSelfReaction&&r.hasStartedAnimating()&&r.animationProgressFrames<t;},getClusterIsLookingAtCenter:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c('SpatialReactionAnimationConfig')),u=t.MOVE_TO_CENTER.FRAMES,v=u+t.LOOK_AT_CENTER.FRAMES;return s>=u&&s<v;},getClusterIsMovingBackTowardCenter:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c('SpatialReactionAnimationConfig')),u=t.MOVE_TO_CENTER.FRAMES+t.LOOK_AT_CENTER.FRAMES,v=u+t.MOVE_BACK_TOWARD_CENTER.FRAMES;return s>=u&&s<v;},getReactionFaceOffset:function q(r,s){var t=p.getClusterIsLookingAtCenter,u=p.getClusterIsMovingBackTowardCenter,v=p.getLookAtCenterProgressFrames,w=p.getReactionIndexOnLeft,x=w(s),y=0,z=c('SpatialReactionAnimationConfig').DISTANCES.MAX_FACE_OFFSET.PX*(x?1:-1);if(t(r)){var aa=v(r),ba=p.getDurationsForClusterType(r,c('SpatialReactionAnimationConfig')),ca=ba.LOOK_AT_CENTER.FRAMES;return i.solve(aa,y,z,ca);}else if(u(r)){return z;}else return y;},getReactionFaceFlipOutOffset:function q(r,s){var t=p.getClusterIsLookingAtCenter,u=p.getLookAtCenterProgressFrames,v=p.getReactionIndexOnLeft,w=p.getClusterIsMovingBackTowardCenter,x=v(s),y=0,z=c('SpatialReactionAnimationConfig').DISTANCES.FACE_FLIP_OUT_OFFSET.PX*(x?1:-1);if(t(r)){var aa=u(r),ba=p.getDurationsForClusterType(r,c('SpatialReactionAnimationConfig')),ca=ba.LOOK_AT_CENTER.FRAMES,da=ba.FACE_FLIP.FRAMES,ea=ba.FACE_HANG.FRAMES,fa=ca-da-ea;return k.solve(aa,y,z,ca,fa,ea);}else if(w(r)){return z;}else return y;},getReactionProfilePictureOffset:function q(r,s){var t=p.getLookAtCenterProgressFrames,u=p.getClusterIsLookingAtCenter,v=p.getClusterIsMovingBackTowardCenter,w=p.getReactionIndexOnLeft,x=w(s),y=0,z=c('SpatialReactionAnimationConfig').DISTANCES.MAX_PROFILE_PICTURE_OFFSET.PX*(x?1:-1);if(u(r)){var aa=t(r),ba=p.getDurationsForClusterType(r,c('SpatialReactionAnimationConfig')),ca=ba.LOOK_AT_CENTER.FRAMES,da=ba.FACE_FLIP.FRAMES,ea=ba.FACE_HANG.FRAMES,fa=ca-da-ea;return k.solve(aa,z,-(z-y),ca,fa,ea);}else if(v(r)){return y;}else return z;},addTransitionEndListener:function q(r,s){return new (c('Promise'))(function(t,u){r.addEventListener(n,function(v){if(v.propertyName===s)t();});});},addTransition:function q(r,s,t,u){var v=p.addTransitionEndListener(r,t);c('CSS').addClass(r,s);u();return v;},addAnimationEndListener:function q(r,s){return new (c('Promise'))(function(t,u){r.addEventListener(m,function(v){if(v.animationName===s)t();});});},addTemporaryAnimation:function q(r,s,t){return new (c('Promise'))(function(u,v){p.addAnimationEndListener(r,t).then(function(){c('CSS').removeClass(r,s);u();}).done();c('CSS').addClass(r,s);});},moveElementToPosition:function q(r,s){c('Style').set(r,'left',s.x+'px');c('Style').set(r,'top',s.y+'px');},pollForAnimationProgress:function q(r){return new (c('Promise'))(function(s,t){var u=c('setInterval')(function(){if(r()){clearInterval(u);s();}},o);});},getReactionCenterOffset:function q(r){return new (c('Vector'))(r/2,r/2);},getReactionClickPositionRelativeToViewport:function q(r,s,t){var u=c('SpatialReactionAnimationConfig').SIZES.BASE.PX,v=p.getReactionCenterOffset(u),w=6,x=0;switch(t){case c('FeedbackReactionType').LOVE:x=1;break;case c('FeedbackReactionType').HAHA:x=2;break;case c('FeedbackReactionType').WOW:x=3;break;case c('FeedbackReactionType').SORRY:x=4;break;case c('FeedbackReactionType').ANGER:x=5;break;default:break;}var y=s-v.y,z=v.x+u*x+w*x;return new (c('Vector'))(Math.floor(z),Math.floor(y));},isPositionIndexOnLeftSide:function q(r){return r<Math.floor(c('SpatialReactionAnimationConfig').CLICK.NUM_POSITIONS/2);},clusterIsVisibleOnLeft:function q(r,s,t,u,v,w,x){return p.clusterIsVisibleInViewport(r,s-u,t,v,w,x);},clusterIsVisibleOnRight:function q(r,s,t,u,v,w,x){return p.clusterIsVisibleInViewport(r,s+u,t,v,w,x);},clusterIsVisibleInViewport:function q(r,s,t,u,v,w){var x=p.get2dDiscretePointFromCurrentView(r.originalYaw,r.originalPitch,s,t,u,v,w),y=x.x,z=x.y;return c('SpatialReactionsUtils').isVectorWithinViewport({x:y,y:z},v,w);},get2dDiscretePointFromCurrentView:function q(r,s,t,u,v,w,x){var y=c('SphericalProjectionUtils').convert3dTo2dScaledUnique(r,s,t,u,v,w,x),z=y.x,aa=y.y;return {x:Math.floor(z),y:Math.floor(aa)};}};f.exports=p;}),null);
__d('SpatialReactionsImageCache',['Promise','DOM','FeedbackReactionType','immutable','SpatialReactionImagePaths'],(function a(b,c,d,e,f,g){'use strict';var h=[c('SpatialReactionImagePaths').BASES.LIKE,c('SpatialReactionImagePaths').BASES.LOVE,c('SpatialReactionImagePaths').BASES.WOW,c('SpatialReactionImagePaths').BASES.HAHA,c('SpatialReactionImagePaths').BASES.SORRY,c('SpatialReactionImagePaths').BASES.ANGER,c('SpatialReactionImagePaths').FACES.LIKE,c('SpatialReactionImagePaths').FACES.LOVE,c('SpatialReactionImagePaths').FACES.WOW,c('SpatialReactionImagePaths').FACES.HAHA,c('SpatialReactionImagePaths').FACES.SORRY,c('SpatialReactionImagePaths').FACES.ANGER];function i(){this.$SpatialReactionsImageCache1=c('immutable').Map();this.$SpatialReactionsImageCache2=c('immutable').Map();this.$SpatialReactionsImageCache3=c('immutable').Map();}i.prototype.loadStaticImages=function(j){this.$SpatialReactionsImageCache4=j;var k=h.concat(j).map(this.$SpatialReactionsImageCache5);return new (c('Promise'))(function(l,m){c('Promise').all(k).then(function(n){var o=n[0],p=n[1],q=n[2],r=n[3],s=n[4],t=n[5],u=n[6],v=n[7],w=n[8],x=n[9],y=n[10],z=n[11],aa=n[12];this.$SpatialReactionsImageCache1=this.$SpatialReactionsImageCache1.set(c('FeedbackReactionType').LIKE,o).set(c('FeedbackReactionType').LOVE,p).set(c('FeedbackReactionType').WOW,q).set(c('FeedbackReactionType').HAHA,r).set(c('FeedbackReactionType').SORRY,s).set(c('FeedbackReactionType').ANGER,t);this.$SpatialReactionsImageCache2=this.$SpatialReactionsImageCache1.set(c('FeedbackReactionType').LIKE,u).set(c('FeedbackReactionType').LOVE,v).set(c('FeedbackReactionType').WOW,w).set(c('FeedbackReactionType').HAHA,x).set(c('FeedbackReactionType').SORRY,y).set(c('FeedbackReactionType').ANGER,z);this.$SpatialReactionsImageCache3=this.$SpatialReactionsImageCache3.set(j,aa);l();}.bind(this),m).done();}.bind(this));};i.prototype.getReactionBaseImage=function(j){return this.$SpatialReactionsImageCache1.get(j);};i.prototype.getReactionFaceImage=function(j){return this.$SpatialReactionsImageCache2.get(j);};i.prototype.hasReactionBaseImage=function(j){return this.$SpatialReactionsImageCache1.has(j);};i.prototype.hasReactionFaceImage=function(j){return this.$SpatialReactionsImageCache2.has(j);};i.prototype.putFriendImage=function(j){return this.$SpatialReactionsImageCache6(j);};i.prototype.getFriendImage=function(j){return this.$SpatialReactionsImageCache3.get(j);};i.prototype.hasFriendImage=function(j){return this.$SpatialReactionsImageCache3.has(j);};i.prototype.getOwnProfilePhotoURI=function(){return this.$SpatialReactionsImageCache4;};i.prototype.$SpatialReactionsImageCache6=function(j){return new (c('Promise'))(function(k,l){if(this.hasFriendImage(j)){k(null);}else this.$SpatialReactionsImageCache5(j).then(function(m){this.$SpatialReactionsImageCache3=this.$SpatialReactionsImageCache3.set(j,m);k(null);}.bind(this)).done();}.bind(this));};i.prototype.$SpatialReactionsImageCache5=function(j){return new (c('Promise'))(function(k,l){var m=c('DOM').create('img');m.onload=function(){return k(m);};m.onerror=l;m.src=j;});};f.exports=new i();}),null);
__d('SpatialReactionsProductionStore',['SpatialReactionAnimationConfig','SphericalVideoComponentConstants','SphericalVideoComponentDispatcher','FluxReduceStore','SphericalViewportControlStore','immutable','Vector','UFIVideoPlayerRegistry','SpatialReactionsUtils','range'],(function a(b,c,d,e,f,g){'use strict';var h,i,j,k,l=c('SpatialReactionsUtils').isVectorWithinViewport,m=c('SpatialReactionAnimationConfig').CLICK.NUM_POSITIONS;h=babelHelpers.inherits(n,c('immutable').Record({shouldLeaveReactionMenuOpen:false,isMouseDown:false,isDragging:false,mousePositionRelativeToCanvas:null,nextClickReactionPositionIndex:0,originalDragPosition:null}));i=h&&h.prototype;function n(){h.apply(this,arguments);}j=babelHelpers.inherits(o,c('FluxReduceStore'));k=j&&j.prototype;o.prototype.getVideoPlayerController=function(p){var q=c('UFIVideoPlayerRegistry').getAvailableVideoPlayerController(p);if(!q)return null;return q;};o.prototype.getInitialState=function(){return new n();};o.prototype.reduce=function(p,q){switch(q.type){case c('SphericalVideoComponentConstants').ACTIONS.SET_SHOULD_LEAVE_REACTION_MENU_OPEN:p=p.set('shouldLeaveReactionMenuOpen',q.leaveOpen);break;case c('SphericalVideoComponentConstants').ACTIONS.SET_MOUSE_DOWN:p=this.$SpatialReactionsProductionStore1(p,q.reactionCenter);break;case c('SphericalVideoComponentConstants').ACTIONS.SET_MOUSE_UP:p=this.$SpatialReactionsProductionStore2(p,q.id,q.reactionCenter);break;case c('SphericalVideoComponentConstants').ACTIONS.SET_IS_DRAGGING:p=p.set('isDragging',q.isDragging);break;case c('SphericalVideoComponentConstants').ACTIONS.DROP_REACTION:p=p.set('mousePositionRelativeToCanvas',null);p=p.set('originalDragPosition',null);break;case c('SphericalVideoComponentConstants').ACTIONS.CLICK_REACTION:p=this.$SpatialReactionsProductionStore3(p);break;default:break;}return p;};o.prototype.shouldLeaveReactionMenuOpen=function(){return this.$SpatialReactionsProductionStore4(this.getState());};o.prototype.getIsMouseDown=function(){return this.$SpatialReactionsProductionStore5(this.getState());};o.prototype.getOriginalMousePosition=function(){var p=this.$SpatialReactionsProductionStore6(this.getState());if(!p)throw new Error('User is not dragging yet');return p;};o.prototype.getReactionPositionVector=function(){return this.$SpatialReactionsProductionStore7(this.getState());};o.prototype.getIsReactionWithinViewport=function(p,q){return this.$SpatialReactionsProductionStore8.apply(this,[this.getState()].concat(Array.prototype.slice.call(arguments)));};o.prototype.getNextClickReactionPositionIndex=function(){return this.$SpatialReactionsProductionStore9(this.getState());};o.prototype.$SpatialReactionsProductionStore7=function(p){var q=p.mousePositionRelativeToCanvas;if(!q)throw new Error('User is not dragging yet');return q;};o.prototype.$SpatialReactionsProductionStore8=function(p,q,r){var s=p.mousePositionRelativeToCanvas;if(!s)throw new Error('User is not dragging yet');return l(s,q,r);};o.prototype.$SpatialReactionsProductionStore4=function(p){return p.shouldLeaveReactionMenuOpen;};o.prototype.$SpatialReactionsProductionStore5=function(p){return p.isMouseDown;};o.prototype.$SpatialReactionsProductionStore6=function(p){return p.originalDragPosition;};o.prototype.$SpatialReactionsProductionStore10=function(p,q){return q.sub(c('SphericalViewportControlStore').getViewportPositionVector(p));};o.prototype.$SpatialReactionsProductionStore9=function(p){return p.nextClickReactionPositionIndex;};o.prototype.$SpatialReactionsProductionStore1=function(p,q){var r=new (c('Vector'))(c('SpatialReactionAnimationConfig').SIZES.BASE.PX/2,0),s=q.sub(r);p=p.set('originalDragPosition',s);p=p.set('isMouseDown',true);return p;};o.prototype.$SpatialReactionsProductionStore2=function(p,q,r){p=p.set('isMouseDown',false);var s=this.$SpatialReactionsProductionStore10(q,r);p=p.set('mousePositionRelativeToCanvas',s);return p;};o.prototype.$SpatialReactionsProductionStore3=function(p){var q=p.nextClickReactionPositionIndex,r=Math.floor(m/2),s=q<r,t=c('range')(0,m).filter(function(u){return s?!(u<r):u<r;}).reduce(function(u,v,w,x){return u===null?x[Math.floor(Math.random()*x.length)]:u;},null);return p.set('nextClickReactionPositionIndex',t);};function o(){j.apply(this,arguments);}f.exports=new o(c('SphericalVideoComponentDispatcher'));}),null);
__d('SpatialReactionsState',['immutable'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('immutable').Record({reactionClusters:c('immutable').Set()}));i=h&&h.prototype;function j(){'use strict';h.apply(this,arguments);}f.exports=j;}),null);
__d('SpatialReactionsConsumptionStore',['invariant','SpatialReactionAnimationConfig','SpatialReactionAnimationUtils','SphericalVideoComponentConstants','SphericalVideoComponentDispatcher','FluxMapStore','SpatialReactionsImageCache','immutable','SpatialReaction','SpatialReactionCluster','SpatialReactionsState','SpatialReactionsProductionStore','VideoPlayerControllerStore','SpatialReactionExperimentsStore','SphericalViewportControlStore','curry','denormalizeYaw','degToRad','radToDeg','SphericalProjectionUtils'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('SphericalProjectionUtils').distanceBetweenSphericalCoordinatesDeg,l=c('SpatialReactionAnimationConfig').DURATIONS.SELF.TOTAL.FRAMES,m=.7;i=babelHelpers.inherits(n,c('FluxMapStore'));j=i&&i.prototype;n.prototype.getInitialState=function(){return c('immutable').Map({});};n.prototype.reduce=function(o,p){var q=p.id,r=c('curry')(o.set.bind(o),q);switch(p.type){case c('SphericalVideoComponentConstants').ACTIONS.REGISTER_NEW_REACTIONS_STATE:o=r(new (c('SpatialReactionsState'))());break;case c('SphericalVideoComponentConstants').ACTIONS.ADD_SPATIAL_REACTIONS:o=this.$SpatialReactionsConsumptionStore1(q,o,p.reactionClusters);break;case c('SphericalVideoComponentConstants').ACTIONS.DROP_REACTION:o=this.$SpatialReactionsConsumptionStore2(q,o,p.reactionType,p.reactionOutsideViewport,p.recordMouseLocation,p.viewportWidth,p.viewportHeight,p.viewportYaw,p.viewportPitch,p.viewportFieldOfView,p.recordReactionCallback);break;case c('SphericalVideoComponentConstants').ACTIONS.TICK_ANIMATION:o=this.$SpatialReactionsConsumptionStore3(q,o);o=this.$SpatialReactionsConsumptionStore4(q,o);break;case c('SphericalVideoComponentConstants').ACTIONS.START_ANIMATION_FOR_FRAME:o=this.$SpatialReactionsConsumptionStore5(q,o,p.timestamp,p.yaw,p.pitch,p.fieldOfView,p.viewportWidth,p.viewportHeight);break;case c('SphericalVideoComponentConstants').ACTIONS.SEEK_START:o=this.$SpatialReactionsConsumptionStore6(q,o);break;default:break;}return o;};n.prototype.getSpatialReactionsState=function(o){return this.$SpatialReactionsConsumptionStore7(o,this.getState());};n.prototype.$SpatialReactionsConsumptionStore7=function(o,p){return p.get(o);};n.prototype.$SpatialReactionsConsumptionStore8=function(o,p,q,r){var s=p.get(o).set(q,r);return p.set(o,s);};n.prototype.$SpatialReactionsConsumptionStore2=function(o,p,q,r,s,t,u,v,w,x,y){if(r||c('SpatialReactionExperimentsStore').shouldDisableReactions(o)){y();return p;}y(Math.floor(v),Math.floor(w));return this.$SpatialReactionsConsumptionStore9(o,p,q,v,w,c('VideoPlayerControllerStore').getCurrentTime(o));};n.prototype.$SpatialReactionsConsumptionStore9=function(o,p,q,r,s,t){var u=c('SpatialReactionsImageCache').getOwnProfilePhotoURI();if(!u)return p;var v=p.get(o),w=new (c('SpatialReactionCluster'))({animationDurationFrames:l,animationProgressFrames:-1,friendReactions:c('immutable').Set.of(new (c('SpatialReaction'))({animationRandomSeed:Math.random(),isFriend:true,profilePictureURI:u,reactionType:q,positionIndex:c('SpatialReactionsProductionStore').getNextClickReactionPositionIndex()})),originalYaw:c('denormalizeYaw')(r),originalPitch:s,timestamp:t,isSelfReaction:true});p=p.set(o,v);return this.$SpatialReactionsConsumptionStore1(o,p,c('immutable').Set.of(w));};n.prototype.$SpatialReactionsConsumptionStore1=function(o,p,q){var r=p.get(o),s=r,t=s.reactionClusters;q.forEach(function(u){var v=u.friendReactions;v.forEach(function(w){w.profilePictureURI||h(0);w.isFriend||h(0);c('SpatialReactionsImageCache').putFriendImage(w.profilePictureURI);});});t=t.union(q);r=r.set('reactionClusters',t);return p.set(o,r);};n.prototype.$SpatialReactionsConsumptionStore5=function(o,p,q,r,s,t,u,v){var w=c('SpatialReactionAnimationUtils').canStartClusterAnimation,x=c('SpatialReactionAnimationUtils').clusterIsVisibleOnLeft,y=c('SpatialReactionAnimationUtils').clusterIsVisibleOnRight,z=c('SpatialReactionAnimationUtils').clusterIsVisibleInViewport,aa=p.get(o),ba=aa.reactionClusters,ca=c('SpatialReactionExperimentsStore').shouldDisableInitialViewportReactions(o),da=k(c('SphericalViewportControlStore').getInitialYaw(o),c('SphericalViewportControlStore').getInitialPitch(o),r,s),ea=da<30,fa=c('SpatialReactionExperimentsStore').shouldOnlyShowHints(o),ga=ba.count(function(ka){return ka.hasStartedAnimating()&&!ka.isSelfReaction;}),ha=u/v,ia=c('radToDeg')(2*Math.atan(Math.tan(c('degToRad')(t)/2)*ha)),ja=function ka(la){var ma=la;if(w(q,la,c('SpatialReactionsImageCache')))if(la.isSelfReaction){ma=la.startAnimation(r,s);}else if(ga<1)if(z(la,r,s,t,u,v)){if(!(fa||ca&&ea))ma=la.startAnimation(r,s);}else if(x(la,r,s,ia,t,u,v)){var na=true;ma=la.startAnimation(r-ia*m,s,na);}else if(y(la,r,s,ia,t,u,v)){var oa=true;ma=la.startAnimation(r+ia*m,s,oa);}return ma;};return this.$SpatialReactionsConsumptionStore10(o,p,ja);};n.prototype.$SpatialReactionsConsumptionStore3=function(o,p){var q=function r(s){return s.hasStartedAnimating()?s.tickAnimation():s;};return this.$SpatialReactionsConsumptionStore10(o,p,q);};n.prototype.$SpatialReactionsConsumptionStore4=function(o,p){var q=c('SpatialReactionAnimationUtils').resetClusterAnimationIfNeeded;p=this.$SpatialReactionsConsumptionStore10(o,p,q);return p;};n.prototype.$SpatialReactionsConsumptionStore6=function(o,p){return this.$SpatialReactionsConsumptionStore10(o,p,c('SpatialReactionAnimationUtils').resetClusterAnimation);};n.prototype.$SpatialReactionsConsumptionStore10=function(o,p,q){var r=p.get(o),s=r,t=s.reactionClusters;t=t.map(q);r=r.set('reactionClusters',t);return p.set(o,r);};n.prototype.$SpatialReactionsConsumptionStore11=function(o,p,q){var r=p.get(o),s=r,t=s.reactionClusters;t=t.filter(q);r=r.set('reactionClusters',t);return p.set(o,r);};function n(){i.apply(this,arguments);}f.exports=new n(c('SphericalVideoComponentDispatcher'));}),null);
__d('SpatialReactionsConsumptionLoggingStore',['invariant','SphericalVideoComponentConstants','SphericalVideoComponentDispatcher','FluxMapStore','immutable','SpatialReactionsConsumptionStore','SphericalViewportControlStore','SpatialReactionConsumptionTypedLogger','SpatialReactionConsumptionLoggingEvents','SpatialReactionDisplayStates'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k,l,m=100,n=Math.floor;i=babelHelpers.inherits(o,c('immutable').Record({clusterPitch:null,clusterYaw:null,displayState:null,friendCount:0,hasNonFriend:false,isDisplayingCluster:false,moveTowardHint:false,reactionType:null,timestamp:null,viewportPitch:null,viewportYaw:null}));j=i&&i.prototype;function o(){i.apply(this,arguments);}k=babelHelpers.inherits(p,c('FluxMapStore'));l=k&&k.prototype;p.prototype.getInitialState=function(){return c('immutable').Map({});};p.prototype.reduce=function(q,r){var s=r.id;switch(r.type){case c('SphericalVideoComponentConstants').ACTIONS.REGISTER_NEW_REACTIONS_STATE:q=q.set(s,new o());break;case c('SphericalVideoComponentConstants').ACTIONS.TICK_ANIMATION:q=this.$SpatialReactionsConsumptionLoggingStore1(q,s);break;default:break;}return q;};p.prototype.$SpatialReactionsConsumptionLoggingStore1=function(q,r){var s=this.$SpatialReactionsConsumptionLoggingStore2(r,q),t=s.isDisplayingCluster,u=c('SpatialReactionsConsumptionStore').getSpatialReactionsState(r);if(u){var v=u.get('reactionClusters'),w=v.filter(function(y){return !y.isSelfReaction&&y.hasStartedAnimating();}),x=w.size>0;if(x&&!t){q=this.$SpatialReactionsConsumptionLoggingStore3(r,q,v);}else if(!x&&t){q=this.$SpatialReactionsConsumptionLoggingStore4(r,q);this.$SpatialReactionsConsumptionLoggingStore5(q.get(r));q=this.$SpatialReactionsConsumptionLoggingStore6(r,q);}}return q;};p.prototype.$SpatialReactionsConsumptionLoggingStore3=function(q,r,s){var t=s.filter(function(ga){return !ga.isSelfReaction&&ga.hasStartedAnimating();});if(t.size===1){var u=t.first(),v=u.animationYaw,w=u.animationPitch,x=u.friendReactions,y=u.anonymousReactions,z=u.timestamp;v!==null&&w!==null||h(0);var aa=c('SphericalViewportControlStore').getOrientation(q),ba=this.$SpatialReactionsConsumptionLoggingStore2(q,r),ca=x.union(y).countBy(function(ga){return ga.reactionType;}).sortBy(function(ga,ha){return -ga;}).flip().first(),da=x.size,ea=y.size>0,fa=u.isHint?c('SpatialReactionDisplayStates').HINT:c('SpatialReactionDisplayStates').DISPLAY;ba=ba.set('isDisplayingCluster',true).set('clusterYaw',n(v)).set('clusterPitch',n(w)).set('timestamp',n(z)).set('reactionType',ca).set('friendCount',da).set('hasNonFriend',ea).set('viewportYaw',n(aa.yaw)).set('viewportPitch',n(aa.pitch)).set('displayState',fa);r=r.set(q,ba);}return r;};p.prototype.$SpatialReactionsConsumptionLoggingStore4=function(q,r){var s=this.$SpatialReactionsConsumptionLoggingStore2(q,r);if(s.displayState===c('SpatialReactionDisplayStates').HINT){var t=c('SphericalViewportControlStore').getOrientation(q),u=s,v=u.viewportYaw,w=u.viewportPitch,x=u.clusterYaw,y=u.clusterPitch;v!==null&&w!==null&&x!==null&&y!==null||h(0);var z=this.$SpatialReactionsConsumptionLoggingStore7(v-x,w-y),aa=this.$SpatialReactionsConsumptionLoggingStore7(t.yaw-x,t.pitch-y);s=s.set('moveTowardHint',z-aa>m);}r=r.set(q,s);return r;};p.prototype.$SpatialReactionsConsumptionLoggingStore7=function(q,r){return r*r+q*q;};p.prototype.$SpatialReactionsConsumptionLoggingStore6=function(q,r){return r.set(q,new o());};p.prototype.$SpatialReactionsConsumptionLoggingStore5=function(q){var r=new (c('SpatialReactionConsumptionTypedLogger'))();r.setEvent(c('SpatialReactionConsumptionLoggingEvents').SPATIAL_REACTION_DISPLAY).setYaw(q.get('clusterYaw')).setPitch(q.get('clusterPitch')).setDisplayState(q.get('displayState')).setFriendCount(q.get('friendCount')).setHasNonFriend(q.get('hasNonFriend')).setMoveTowardsHint(q.get('moveTowardHint')).setReactionKey(q.get('reactionType')).setVideoTimestamp(q.get('timestamp')).setCenterYaw(q.get('viewportYaw')).setCenterPitch(q.get('viewportPitch'));r.log();r.clear();};p.prototype.$SpatialReactionsConsumptionLoggingStore2=function(q,r){return r.get(q);};p.prototype.finishTrackingCluster=function(q,r){return this.$SpatialReactionsConsumptionLoggingStore4(q,r);};function p(){k.apply(this,arguments);}f.exports=new p(c('SphericalVideoComponentDispatcher'));}),null);
__d('SphericalVideoComponent',['SphericalVideoComponentActions','SphericalVideoComponentDispatcher','VideoPlayerControllerStore','SphericalViewportControlStore','SpatialReactionsConsumptionStore','SpatialReactionsProductionStore','SpatialReactionFunnelLoggingStore','SpatialReactionsConsumptionLoggingStore','SpatialReactionExperimentsStore','abstractMethod'],(function a(b,c,d,e,f,g){'use strict';h.getStores=function(){return [c('VideoPlayerControllerStore'),c('SphericalViewportControlStore'),c('SpatialReactionsConsumptionStore'),c('SpatialReactionsProductionStore'),c('SpatialReactionFunnelLoggingStore'),c('SpatialReactionsConsumptionLoggingStore'),c('SpatialReactionExperimentsStore')];};h.prototype.getInitialState=function(i){return c('abstractMethod')('SphericalVideoComponent','getInitialState');};h.prototype.calculateState=function(i){return c('abstractMethod')('SphericalVideoComponent','calculateState');};function h(i){this.onStoreChange=function(){var o=this.calculateState(this.state);this.onStateChange(this.state,o);this.state=o;}.bind(this);c('SphericalVideoComponentDispatcher').explicitlyRegisterStores([c('SphericalViewportControlStore'),c('VideoPlayerControllerStore'),c('SpatialReactionsConsumptionStore'),c('SpatialReactionsProductionStore'),c('SpatialReactionFunnelLoggingStore'),c('SpatialReactionsConsumptionLoggingStore'),c('SpatialReactionExperimentsStore')]);this.id=i.getVideoPlayerID();c('SphericalVideoComponentActions').registerVideoPlayerController(i);this.state=this.getInitialState(this.id);for(var j=h.getStores(),k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var m;if(k){if(l>=j.length)break;m=j[l++];}else{l=j.next();if(l.done)break;m=l.value;}var n=m;n.addListener(this.onStoreChange);}}h.prototype.onStateChange=function(i,j){return;};f.exports=h;}),null);